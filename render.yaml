services:
  - type: web
    name: defi10-api
    runtime: dotnet
    plan: starter
    buildCommand: |
      cd backend/MyWebWallet.API
      dotnet restore
      dotnet publish -c Release -o out --no-restore
    startCommand: |
      cd backend/MyWebWallet.API/out
      dotnet MyWebWallet.API.dll
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: http://0.0.0.0:$PORT
      - key: ASPNETCORE_HTTP_PORTS
        value: $PORT
      # External API Keys - These should be configured in Render Dashboard
      - key: Moralis__ApiKey
        sync: false
      - key: Alchemy__ApiKey
        sync: false
      - key: UniswapV3__ApiKey
        sync: false
      # API Base URLs (safe to include)
      - key: Moralis__BaseUrl
        value: https://deep-index.moralis.io/api/v2.2
      - key: Aave__GraphQLEndpoint
        value: https://api.v3.aave.com/graphql
      - key: UniswapV3__GraphQLEndpoint
        value: https://gateway.thegraph.com/api/subgraphs/id/HMuAwufqZ1YCRmzL2SfHTVkzZovC9VL2UAKhjvRqKiR1
      - key: Base__RpcUrl
        value: https://mainnet.base.org
      # Alchemy URLs - Dynamic URLs that depend on API Key
      - key: Ethereum__RpcUrl
        sync: false
      - key: Alchemy__NftUrl
        sync: false
      - key: Alchemy__BaseRpcUrl
        sync: false
      # Redis connection (auto-configured from service)
      - key: Redis__ConnectionString
        fromService:
          type: redis
          name: mywebwallet-redis
          property: connectionString
      - key: Redis__User
        value: default
      - key: Redis__Password
        fromService:
          type: redis
          name: mywebwallet-redis
          property: password
      # Cache configuration (safe to include)
      - key: Redis__DefaultExpiration
        value: "00:30:00"
      - key: Redis__WalletCacheKeyPrefix
        value: "wallet:"
      - key: Redis__TokenLogoKeyPrefix
        value: "token_logo:"
      - key: Redis__TokenLogoExpiration
        value: "0.00:00:00"
    healthCheckPath: /health

  - type: redis
    name: defi10-redis
    plan: starter
    ipAllowList: []